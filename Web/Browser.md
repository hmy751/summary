
# 브라우저의 구조
---
- User Interface - 유저와 상호작용하는 부분을 말한다. 주소 표시줄, 주소창, 뒤로/앞으로 가기 버튼 등이 있으며 개인화가 가능하게 설계되어 있다.
- Browser Engine - 서버와 사용자 상호 작용에서 가져온 웹 콘텐츠를 조정하는 역할을 하며, UI와 렌더링 엔진 사이의 동작을 제어한다.
- Rendering Engine - 요청한 웹 콘텐츠를 해석하고 표시한다. 대부분의 브라우저에서는 브라우저 엔진과 렌더링 엔진이 함께 작동하여 콘텐츠를 보여준다.
- Networking - HTTP 요청과 같이 통신 부분을 처리한다.
- UI Backend - 콤보 박스와 창 같은 기본적인 장치를 그린다. OS에서 이미 자체적으로 가지고 있는 UI들이다.
- Javascript Interpreter - 웹 컨텐츠를 조작하고 웹 페이지에 동적 동작을 가능하게 해주는 요소다.
- Data Storage - 브라우저 동작에 필요한 자료를 저장하는 계층이다.

# 브라우저 렌더링 과정
---
웹 페이지에 필요한 리소스를 받고 해석하여 여러 과정을 거쳐 콘텐츠를 보여주는 과정을 브라우저의 렌더링 과정이라 한다.
크게 Parsing => Calculate Style  => Layout => Paint => Composite & Render 과정으로 이루어진다.

## Parsing(파싱)
파싱은 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 작업을 의미한다. HTML파일을 해석하여 리소스 구성에 따라 DOM 트리 및 CSSOM 트리를 구성한다.
파싱 결과는 부모-자식 관계를 가지는 노트 트리 구조이다.
### DOM 트리 구성
렌더링 엔진에서 HTML데이터를 수신하고 해석, 파싱 과정을 거쳐 DOM을 생성한 후, 각 DOM 객체를 트리 데이터 구조로 연결해 DOM트리를 구성한다.
### CSSOM 트리 구성
파싱 과정 중 스타일시트 파일을 만나면 CSS를 해석하며 CSSOM 트리를 구성한다.

## Calculate Style(스타일 계산)
스타일 계산 단계에서는 파싱 단계에서 생성된 DOM, CSSOM 트리를 가지고 스타일 매칭 후 렌더 트리를 구성한다. 

## Layout(레이아웃)
레이아웃 단계에서는 노드의 정확한 위치와 크기를 계산한다. 루트 노드 부터 노드를 순회하면서 계산하고, 레이아웃의 결과로 각 노드의 정확한 위치와 크기를 픽셀값으로 렌더 트리에 반영한다.
CSS에서 %값으로 크기를 지정하면 레이아웃 단계를 거쳐 측정 가능한 픽셀 단위로 변환된다.

## Paint(페인트)
레이아웃 단계에서 계산된 값을 이용해 렌더 트리의 각 노드를 화면상의 실제 픽셀로 변환한다.
이때 위치, 크기, 모양과 관계없는 CSS 속성(색상, 투명도 등)을 적용하여 색을 칠하는 순서를 판단한다. transform 속성등을 기준으로 픽셀로 변환된 결과들은 포토샵의 레이어 처럼 생성되어 개별 레이어로 관리된다. 

## Composite & Render(합성 & 렌더)
페인트 단계에서 생성된 레이어를 합성하여 스크린을 업데이트하며 화면에서 웹 페이지를 볼 수 있다.

# 브라우저의 동시성
---
자바스크립트는 싱글 스레드 기반의 언어다. 싱글 스레드로 동작하기 때문에 [[Async, Promise#^c6e5a8|블로킹]]이 발생할 수 밖에 없고 자바스크립트 엔진 만으로는 브라우저의 동시성(Concurrency)을 지원할 수 없다.
이를 위해 자바스크립트 뿐만 아니라 브라우저의 여러 스레드와 프로세스를 통해서 동시성을 지원할 수 있다.

## Event Loop(이벤트 루프)
브라우저의 동시성을 위해 자바스크립트 엔진(콜 스택, Heap) 외에 이벤트 루프, Task Queue(테스크 큐), Web API등을 이용하여 브라우저가 지원 하여 처리한다.

- Event Loop - 이벤트 루프는 콜 스택과 테스크 큐 사이에 위치 한다. 
  콜 스택이 비어 있는지 감시하며 비어 있을 경우 테스크 큐에 있는 콜백 함수등을 콜 스택으로 전달한다.
- Task Queue - Web API에서 전달 받은 setTimeout, 이벤트 헨들러등의 콜백 함수를 저장하는 공간이다. 
- Web API - 콜 스택에서 전달 받은 콜백 함수를 받아 Timer 처리를 하며 설정된 시간 이후  테스크 큐로 전달하는 역할을 한다.


### 이벤트 루프 처리 과정


```js
function foo() {

}



```



## 마이크로 테스크 큐와 프로미스


## requestAnimationFrame
